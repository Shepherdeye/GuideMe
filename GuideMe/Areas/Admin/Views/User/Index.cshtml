@model AllUsersResponse

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold mb-0">System Users</h4>
    </div>

    @if (Model.Users.Any())
    {
        <div class="table-responsive shadow-sm rounded bg-white p-3">
            <table class="table table-striped table-hover table-bordered align-middle mb-0 text-center">
                <thead class="table-dark small">
                    <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody class="small">
                    @foreach (var item in Model.Users)
                    {
                        <tr>
                            <td>
                                @if (!string.IsNullOrEmpty(item.ProfileImage))
                                {
                                    <img src="~/identity/profile/@item.ProfileImage" width="40" height="40" class="rounded-circle shadow-sm border" style="object-fit: cover; box-shadow: 0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);" />
                                }
                                else
                                {
                                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 40px; height: 40px;">
                                        <i class="bi bi-person text-secondary"></i>
                                    </div>
                                }
                            </td>
                            <td>@item.FirstName @item.LastName</td>
                            <td>@item.Email</td>
                            <td>
                                <span class="badge @(item.Role switch {
                                    UserRole.SuperAdmin => "bg-danger",
                                    UserRole.Admin => "bg-warning text-dark",
                                    UserRole.Guide => "bg-primary",
                                    UserRole.Visitor => "bg-info text-dark",
                                    _ => "bg-secondary"
                                })">@item.Role</span>
                            </td>
                            <td>
                                @if (item.EmailConfirmed)
                                {
                                    <span class="text-success small"><i class="bi bi-patch-check-fill me-1"></i>Verified</span>
                                }
                                else
                                {
                                    <form asp-action="ConfirmEmail" asp-route-id="@item.Id" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-link btn-sm text-warning p-0 text-decoration-none small">
                                            <i class="bi bi-exclamation-triangle-fill me-1"></i>Verify Now
                                        </button>
                                    </form>
                                }
                            </td>
                            <td>
                                <div class="d-flex justify-content-center gap-1">
                                    <form asp-action="Delete" asp-route-id="@item.Id" method="post" class="d-inline delete-form">
                                        <button type="button" class="btn btn-sm btn-outline-danger px-2 delete-btn" title="Delete Account" 
                                                @(item.Email == User.Identity.Name ? "disabled" : "")>
                                            <i class="bi bi-person-x"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <!-- Pagination -->
        <nav class="mt-3">
            <ul class="pagination pagination-sm justify-content-center">
                @for (var i = 1; i <= Model.PagesNumber; i++)
                {
                    <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                        <a class="page-link" href="/admin/user/index?page=@i">@i</a>
                    </li>
                }
            </ul>
        </nav>
    }
    else
    {
        <div class="text-center py-5">
            <h5 class="text-muted">No Users Found</h5>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.preventDefault();
                const form = btn.closest('form');
                Swal.fire({
                    title: "Delete User?",
                    text: "This will permanently remove the user and all linked data!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    confirmButtonText: "Yes, delete it"
                }).then((result) => {
                    if (result.isConfirmed) form.submit();
                });
            });
        });
    </script>
}
