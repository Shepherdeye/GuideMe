@model AllGuideResponse

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold mb-0">Guides</h4>
        <a asp-action="Create" class="btn btn-sm btn-primary">
            <i class="bi bi-plus-lg"></i> Create New Guide
        </a>
    </div>

    @if (Model.Guides.Any())
    {
        <div class="table-responsive shadow-sm rounded bg-white p-3">
            <table class="table table-sm table-striped table-hover align-middle mb-0 small">
                <thead class="table-dark text-center align-middle">
                    <tr>
                        <th style="width: 40px;">#</th>
                        <th style="width: 100px;">First</th>
                        <th style="width: 100px;">Last</th>
                        <th style="width: 120px;">User</th>
                        <th style="width: 150px;">Email</th>
                        <th style="width: 100px;">Phone</th>
                        <th style="width: 80px;">Gender</th>
                        <th style="width: 100px;">Country</th>
                        <th style="width: 80px;">Role</th>
                        <th style="width: 60px;">Profile</th>
                        <th style="width: 120px;">License Number</th>
                        <th style="width: 120px;">National ID</th>
                        <th style="width: 100px;">Experience</th>
                        <th style="width: 100px;">Email Confirmed</th>
                        <th style="width: 90px;">Actions</th>
                    </tr>
                </thead>

                <tbody class="text-center">
                    @foreach (var item in Model.Guides)
                    {
                        <tr>
                            <td>@item.Id</td>
                            <td>@item.FirstName</td>
                            <td>@item.LastName</td>

                            <!-- Username -->
                            <td>
                                <span class="truncate-text-sm" data-bs-toggle="tooltip" title="@item.UserName"
                                      onclick="showFullText('@item.UserName', 'Username')">
                                    @item.UserName
                                </span>
                            </td>

                            <!-- Email -->
                            <td>
                                <span class="truncate-text-sm" data-bs-toggle="tooltip" title="@item.Email"
                                      onclick="showFullText('@item.Email', 'Email')">
                                    @item.Email
                                </span>
                            </td>

                            <td>@item.PhoneNumber</td>
                            <td>@item.Gender</td>
                            <td>
                                <span class="truncate-text-sm" data-bs-toggle="tooltip" title="@item.Country">
                                    @item.Country
                                </span>
                            </td>

                            <td><span class="badge bg-secondary">@item.Role</span></td>

                            <!-- Profile Image -->
                            <td>
                                @if (item.ProfileImage is not null && item.ProfileImage!="")
                                {
                                    <img src="~/identity/Profile/@item.ProfileImage"
                                     class="rounded-circle border" width="30" height="30" alt="Profile">
                                }
                            </td>

                            <!-- License Number -->
                            <td>
                                <span class="truncate-text-sm" data-bs-toggle="tooltip" title="@item.LicenseNumber"
                                      onclick="showFullText('@item.LicenseNumber', 'License Number')">
                                    @item.LicenseNumber
                                </span>
                            </td>

                            <!-- National ID -->
                            <td>
                                <span class="truncate-text-sm" data-bs-toggle="tooltip" title="@item.NationalId"
                                      onclick="showFullText('@item.NationalId', 'National ID')">
                                    @item.NationalId
                                </span>
                            </td>

                            <!-- Experience -->
                            <td>@item.YearsOfExperience</td>

                            <!-- Email Confirmed -->
                            <td>
                                <span class="badge @(item.EmailConfirmed ? "bg-success" : "bg-warning text-dark")">
                                    @item.EmailConfirmed
                                </span>
                            </td>

                            <!-- Actions -->
                            <td>
                                <div class="d-flex justify-content-center gap-1">
                                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary p-0 px-2" title="Edit">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <form asp-action="Delete" asp-route-id="@item.Id" method="post" class="delete-form d-inline">
                                        <button type="button" class="btn btn-sm btn-outline-danger p-0 px-2 delete-btn" title="Delete">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav class="mt-3" aria-label="pagination">
            <ul class="pagination pagination-sm justify-content-center mb-0">
                @if (Model.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="/admin/guide/index?page=@(Model.CurrentPage - 1)">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                }

                @for (var i = 1; i <= Model.PagesNumber; i++)
                {
                    <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                        <a class="page-link" href="/admin/guide/index?page=@i">@i</a>
                    </li>
                }

                @if (Model.CurrentPage < Model.PagesNumber)
                {
                    <li class="page-item">
                        <a class="page-link" href="/admin/guide/index?page=@(Model.CurrentPage + 1)">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                }
            </ul>
        </nav>
    }
    else
    {
        <div class="text-center py-5">
            <h5 class="text-muted">No Records Found</h5>
        </div>
    }
</div>

<!-- SweetAlert Delete Confirmation -->
<script>
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            const form = this.closest('form');
            Swal.fire({
                title: 'Are you sure?',
                text: "This action cannot be undone!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        });
    });
</script>
<script>
        // Enable all Bootstrap tooltips
        document.addEventListener('DOMContentLoaded', function () {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });

        // Function to show full text in a Bootstrap modal or alert
        function showFullText(text, label) {
            // Create a modal dynamically if not exists
            let modal = document.getElementById("textModal");
            if (!modal) {
                const modalHtml = `
                    <div class="modal fade" id="textModal" tabindex="-1" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="textModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body" id="textModalBody"></div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          </div>
                        </div>
                      </div>
                    </div>`;
                document.body.insertAdjacentHTML("beforeend", modalHtml);
            }

            // Set content
            document.getElementById("textModalLabel").textContent = label || "Details";
            document.getElementById("textModalBody").textContent = text;

            // Show modal
            const modalInstance = new bootstrap.Modal(document.getElementById("textModal"));
            modalInstance.show();
        }
    </script>


<style>
    table.table-sm td, table.table-sm th {
        padding: 0.4rem 0.35rem !important;
        vertical-align: middle !important;
    }

    table {
        font-size: 0.75rem !important;
        table-layout: fixed;
    }

    .truncate-text-sm {
        display: inline-block;
        max-width: 100px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
        color: #0d6efd;
    }

    .truncate-text-sm:hover {
        text-decoration: underline;
    }

    th {
        white-space: nowrap;
    }

    .pagination .page-link {
        padding: 0.25rem 0.5rem;
    }

    .pagination .active .page-link {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
</style>
